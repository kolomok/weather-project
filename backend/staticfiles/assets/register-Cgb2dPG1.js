const g="lang";let a=localStorage.getItem(g)||"ru";const p={"register.title":{ru:"Регистрация",en:"Sign up"},"register.username":{ru:"Логин",en:"Username"},"register.password":{ru:"Пароль",en:"Password"},"register.password2":{ru:"Повторите пароль",en:"Repeat password"},"register.submit":{ru:"Зарегистрироваться",en:"Sign up"},"register.have_account":{ru:"Уже есть аккаунт?",en:"Already have an account?"},"register.login_link":{ru:"Войти",en:"Log in"},"msg.fill_all":{ru:"Пожалуйста, заполните все поля",en:"Please fill all fields"},"msg.pass_mismatch":{ru:"Пароли не совпадают",en:"Passwords do not match"},"msg.success":{ru:"Регистрация прошла успешно",en:"Sign up successful"},"msg.net_error":{ru:"Произошла ошибка при подключении",en:"Network error occurred"}};function s(e){return p[e]&&p[e][a]||e}function f(){document.querySelectorAll("[data-i18n]").forEach(t=>{const c=t.getAttribute("data-i18n"),o=t.getAttribute("data-i18n-attr")||"text",n=s(c);if(o==="text"){if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)return;t.textContent=n}else t.setAttribute(o,n)});const e=document.getElementById("lang-toggle");e&&(e.textContent=a==="ru"?"EN":"RU")}function w(e){a=e,localStorage.setItem(g,e),f()}(function(){document.addEventListener("DOMContentLoaded",()=>{f();const t=document.getElementById("lang-toggle");t&&t.addEventListener("click",()=>{w(a==="ru"?"en":"ru")})})})();function S(e){const t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("form");if(!e)return;const t=e.querySelector("input[name='username']")||e.querySelector("input[type='text']"),c=e.querySelector("input[name='password1']")||e.querySelectorAll("input[type='password']")[0],o=e.querySelector("input[name='password2']")||e.querySelectorAll("input[type='password']")[1],n=e.querySelector("button[type='submit'], button");async function l(y){y.preventDefault();const d=(t?.value||"").trim(),u=c?.value||"",i=o?.value||"";if(!d||!u||!i){alert(s("msg.fill_all"));return}if(u!==i){alert(s("msg.pass_mismatch"));return}try{n&&(n.disabled=!0);const r=await fetch("/api/register/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":S("csrftoken"),Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({username:d,password1:u,password2:i})}),m=(r.headers.get("content-type")||"").toLowerCase().includes("application/json")?await r.json():{};if(!r.ok||m.success!==!0)throw new Error(m.error||`HTTP ${r.status}`);alert(s("msg.success")),window.location.href="/"}catch(r){console.error("register error:",r),alert(s("msg.net_error"))}finally{n&&(n.disabled=!1)}}e.addEventListener("submit",l),n?.addEventListener("click",l)});
