const d="lang";let o=localStorage.getItem(d)||"ru";const a={"login.title":{ru:"Вход",en:"Log in"},"login.username":{ru:"Логин",en:"Username"},"login.password":{ru:"Пароль",en:"Password"},"login.submit":{ru:"Войти",en:"Log in"},"login.fill_all":{ru:"Пожалуйста, заполните все поля",en:"Please fill in all fields"},"login.success":{ru:"Успешный вход",en:"Logged in successfully"},"login.error":{ru:"Ошибка входа",en:"Login error"},"login.something_wrong":{ru:"Что-то пошло не так",en:"Something went wrong"},"login.haveacc":{ru:"У Вас нет аккаунта?",en:"Dont have account?"},"login.haheurl":{ru:"Зарегестрируйтесь сейчас!",en:"Register now!"}};function f(t){document.querySelectorAll("[data-i18n]").forEach(r=>{const e=r.getAttribute("data-i18n"),c=a[e];if(!c||!c[t])return;const l=r.getAttribute("data-i18n-attr")||"text",n=c[t];l==="text"?r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||(r.textContent=n):r.setAttribute(l,n)});const s=document.getElementById("lang-toggle");s&&(s.textContent=t==="ru"?"EN":"RU")}function p(t){o=t,localStorage.setItem(d,t),f(t)}function w(t){const s=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return s?s.pop():""}document.addEventListener("DOMContentLoaded",()=>{f(o);const t=document.querySelector("form");if(!t)return;const s=t.querySelector("input[name='username'], input[type='text']"),r=t.querySelector("input[name='password'], input[type='password']"),e=t.querySelector("button[type='submit'], button");document.getElementById("lang-toggle")?.addEventListener("click",()=>{p(o==="ru"?"en":"ru")}),t.addEventListener("submit",n=>{n.preventDefault(),l()}),e?.addEventListener("click",n=>{n.preventDefault(),l()});async function l(){const n=(s?.value||"").trim(),u=r?.value||"";if(!n||!u){alert(a["login.fill_all"][o]);return}try{e&&(e.disabled=!0,e.dataset.prevText=e.textContent||"",e.textContent="...");const i=await fetch("/api/login/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":w("csrftoken"),Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({username:n,password:u})});if(i.redirected){window.location.href=i.url;return}if(!(i.headers.get("content-type")||"").toLowerCase().includes("application/json")){const m=await i.text();throw new Error(`${a["login.error"][o]}: ${m.slice(0,120)}`)}const g=await i.json();i.ok&&g.success?(alert(a["login.success"][o]),window.location.href="/"):alert(g.error||a["login.error"][o])}catch(i){console.error(i),alert(a["login.something_wrong"][o])}finally{e&&(e.disabled=!1,e.textContent=e.dataset.prevText||a["login.submit"][o])}}});
