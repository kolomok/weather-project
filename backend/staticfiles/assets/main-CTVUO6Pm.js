/* empty css              */const N="unit";let d=localStorage.getItem(N)||"metric",h=null,y=null;const b="lang";let i=localStorage.getItem(b)||"ru";const r={"nav.favorites":{ru:"Избранное",en:"Favorites"},"nav.login":{ru:"Войти",en:"Log in"},"nav.logout":{ru:"Выйти",en:"Log out"},"search.placeholder":{ru:"Найти город...",en:"Search city..."},"weather.now":{ru:"Сейчас",en:"Now"},"weather.humidity":{ru:"Влажность",en:"Humidity"},"weather.wind":{ru:"Ветер",en:"Wind"},"msg.city_not_found":{ru:"Город не найден",en:"City not found"},"msg.geo_unavailable":{ru:"Геолокация не доступна",en:"Geolocation unavailable"},"msg.geo_denied":{ru:"Доступ к геолокации отклонён",en:"Geolocation permission denied"},"msg.load_error":{ru:"Ошибка загрузки",en:"Load error"},"msg.forecast_fail":{ru:"Не удалось загрузить прогноз",en:"Failed to load forecast"}};function W(t){document.querySelectorAll("[data-i18n]").forEach(e=>{const a=e.getAttribute("data-i18n"),o=r[a];if(!o||!o[t])return;const c=e.getAttribute("data-i18n-attr")||"text",g=o[t];c==="text"?e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||(e.textContent=g):e.setAttribute(c,g)});const n=document.getElementById("lang-toggle");n&&(n.textContent=t==="ru"?"EN":"RU")}function R(t){i=t,localStorage.setItem(b,t),W(t)}function w(){return d==="metric"?"°C":"°F"}function z(){return d==="metric"?"м/с":"mph"}function G(){return i==="ru"?"ru-RU":"en-US"}const U=document.getElementById("unitToggle");function H(){U?.querySelectorAll("button[data-unit]")?.forEach(n=>n.classList.toggle("active",n.dataset.unit===d))}H();U?.addEventListener("click",t=>{const n=t.target.closest("button[data-unit]");if(!n)return;const e=n.dataset.unit;e!==d&&(d=e,localStorage.setItem(N,d),H(),P())});const _=document.getElementById("lang-toggle");_&&_.addEventListener("click",()=>{R(i==="ru"?"en":"ru"),P()});const B="a9c23e068a0e62f0ae23ab4a0336b395",m=document.getElementById("city"),A=document.getElementById("temp"),q=document.getElementById("description"),F=document.getElementById("humidity"),M=document.getElementById("wind"),k=document.getElementById("weather-icon"),C=document.getElementById("search-input"),O=document.getElementById("search-btn"),Y=document.getElementById("accButton"),E=document.getElementById("accSett"),Q=document.getElementById("closeSett");W(i);Y?.addEventListener("click",()=>{E.style.display=E.style.display==="flex"?"none":"flex"});Q?.addEventListener("click",()=>{E.style.display=E.style.display==="flex"?"none":"flex"});function j(t){m.textContent=t.name,A.textContent=`${Math.round(t.main.temp)}${w()}`,q.textContent=t.weather[0].description,F.textContent=`${r["weather.humidity"][i]}: ${t.main.humidity}%`,M.textContent=`${r["weather.wind"][i]}: ${t.wind.speed} ${z()}, ${J(t.wind.deg)}`,k.src=`https://openweathermap.org/img/wn/${t.weather[0].icon}@4x.png`,k.alt=t.weather[0].description,V(t.weather[0].main,t.weather[0].icon)}function x(t){const n=document.getElementById("hours");n&&(n.innerHTML="",t.forEach(e=>{const o=new Date(e.dt_txt).getHours().toString().padStart(2,"0"),c=document.createElement("div");c.className="hour-card",c.innerHTML=`
      <p>${o}:00</p>
      <img src="https://openweathermap.org/img/wn/${e.weather[0].icon}@2x.png" alt="${e.weather[0].description}">
      <p>${Math.round(e.main.temp)}${w()}</p>
    `,n.appendChild(c)}))}function V(t,n){const e=document.getElementById("bg-video");if(!e)return;let a="/static/videos/default.mp4";const o=n&&n.includes("n");t==="Clear"?a=o?"/static/videos/clear-night.mp4":"/static/videos/sunny.mp4":t==="Rain"?a=o?"/static/videos/rain-night.mp4":"/static/videos/rain.mp4":t==="Snow"?a=o?"/static/videos/snow-night.mp4":"/static/videos/snow.mp4":t==="Clouds"?a=o?"/static/videos/clouds-night.mp4":"/static/videos/clouds.mp4":t==="Thunderstorm"?a="/static/videos/thunder.mp4":t==="Drizzle"?a="/static/videos/drizzle.mp4":(t==="Mist"||t==="Fog")&&(a="/static/videos/fog.mp4"),e.src=a}function J(t){const n=Math.floor(t/22.5+.5),e=["С","СВ","В","ЮВ","Ю","ЮЗ","З","СЗ"],a=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],o=n%16;return i==="ru"?e[o%e.length]:a[o]}async function v(t){h=t;try{const n=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(t)}&appid=${B}&units=${d}&lang=${i}`),e=await n.json();return n.ok&&e.cod===200?(j(e),y={lat:e.coord.lat,lon:e.coord.lon},await K(e.coord.lat,e.coord.lon),!0):(m.textContent=r["msg.city_not_found"][i],A.textContent="",q.textContent="",F.textContent="",M.textContent="",!1)}catch{return m.textContent=r["msg.load_error"][i],!1}}async function D(t,n){try{const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${t}&lon=${n}&appid=${B}&units=${d}&lang=${i}`),a=await e.json();e.ok&&a.cod===200?(j(a),h=a.name,y={lat:t,lon:n},await K(t,n)):m.textContent=r["msg.load_error"][i]}catch{m.textContent=r["msg.load_error"][i]}}async function K(t,n){try{const a=await(await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${t}&lon=${n}&appid=${B}&units=${d}&lang=${i}`)).json(),o={};a.list.forEach(s=>{const l=new Date(s.dt_txt).toISOString().split("T")[0];o[l]||(o[l]=[]),o[l].push(s)});const c=document.getElementById("week-forecast");if(!c)return;c.innerHTML="",Object.keys(o).forEach((s,L)=>{if(L===0)return;const l=o[s];let I=1/0,$=-1/0,f=l.find(u=>u.dt_txt.includes("12:00:00"));f||(f=l[Math.floor(l.length/2)]),l.forEach(u=>{u.main.temp_min<I&&(I=u.main.temp_min),u.main.temp_max>$&&($=u.main.temp_max)});const p=document.createElement("div");p.className="day-card",p.dataset.date=s,p.innerHTML=`
        <p class="day-name">${new Date(s).toLocaleDateString(G(),{weekday:"long"})}</p>
        <img src="https://openweathermap.org/img/wn/${f.weather[0].icon}@2x.png" id="weather-icon" alt="${f.weather[0].description}">
        <p>${f.weather[0].description}</p>
        <p>Мин: ${Math.round(I)}${w()} | Макс: ${Math.round($)}${w()}</p>
      `,c.appendChild(p),p.addEventListener("click",()=>{document.querySelectorAll(".day-card").forEach(u=>u.classList.remove("active")),p.classList.add("active"),x(o[s])})});const g=Object.keys(o)[0];g&&(x(o[g]),document.getElementById("first-card")?.addEventListener("click",()=>{document.querySelectorAll(".day-card").forEach(s=>s.classList.remove("active")),x(o[g])}))}catch{const e=document.getElementById("week-forecast");e&&(e.innerHTML=`<p>${r["msg.forecast_fail"][i]}</p>`)}}O?.addEventListener("click",()=>{const t=(C?.value||"").trim();t&&v(t)});C?.addEventListener("keypress",t=>{if(t.key==="Enter"){const n=(C?.value||"").trim();n&&v(n)}});(async function(){const e=new URLSearchParams(window.location.search).get("q");e?await v(e)||(T(),window.history&&window.history.replaceState&&window.history.replaceState({},"","/search/")):T()})();function T(){if(!navigator.geolocation){m.textContent=r["msg.geo_unavailable"][i];return}navigator.geolocation.getCurrentPosition(t=>{const{latitude:n,longitude:e}=t.coords;D(n,e)},()=>{m.textContent=r["msg.geo_denied"][i]})}function P(){h?v(h):y&&D(y.lat,y.lon)}const X=document.getElementById("bg-video"),S=document.getElementById("preloader");X?.addEventListener("canplaythrough",()=>{S&&(S.style.opacity="0",setTimeout(()=>{S.style.display="none"},500))});
