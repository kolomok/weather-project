/* empty css              */const M="unit";let u=localStorage.getItem(M)||"metric",C=null,v=null;const P="lang";let o=localStorage.getItem(P)||"ru";const c={"nav.favorites":{ru:"–ò–∑–±—Ä–∞–Ω–Ω–æ–µ",en:"Favorites"},"nav.login":{ru:"–í–æ–π—Ç–∏",en:"Log in"},"nav.logout":{ru:"–í—ã–π—Ç–∏",en:"Log out"},"search.placeholder":{ru:"–ù–∞–π—Ç–∏ –≥–æ—Ä–æ–¥...",en:"Search city..."},"weather.now":{ru:"–°–µ–π—á–∞—Å",en:"Now"},"weather.humidity":{ru:"–í–ª–∞–∂–Ω–æ—Å—Ç—å",en:"Humidity"},"weather.wind":{ru:"–í–µ—Ç–µ—Ä",en:"Wind"},"msg.city_not_found":{ru:"–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω",en:"City not found"},"msg.geo_unavailable":{ru:"–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞",en:"Geolocation unavailable"},"msg.geo_denied":{ru:"–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –æ—Ç–∫–ª–æ–Ω—ë–Ω",en:"Geolocation permission denied"},"msg.load_error":{ru:"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏",en:"Network error"},"msg.forecast_fail":{ru:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑",en:"Failed to load forecast"},"msg.geo_fail":{ru:"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–≥–æ–¥—É –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏",en:"Failed to get geolocation weather"},"msg.add_ok":{ru:"–ì–æ—Ä–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ",en:"City added to favorites"},"msg.add_err":{ru:"–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏",en:"Add to favorites failed"},"msg.no_city":{ru:"–ù–µ –º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞",en:"Can't detect city name"}};function R(s){document.querySelectorAll("[data-i18n]").forEach(d=>{const m=d.getAttribute("data-i18n"),r=c[m];if(!r||!r[s])return;const g=d.getAttribute("data-i18n-attr")||"text",$=r[s];g==="text"?d instanceof HTMLInputElement||d instanceof HTMLTextAreaElement||(d.textContent=$):d.setAttribute(g,$)});const i=document.getElementById("lang-toggle");i&&(i.textContent=s==="ru"?"EN":"RU")}function V(s){o=s,localStorage.setItem(P,s),R(s)}function X(){return o==="ru"?"ru-RU":"en-US"}function S(){return u==="metric"?"¬∞C":"¬∞F"}function Z(){return u==="metric"?"–º/—Å":"mph"}function tt(s="unitToggle"){const i=document.getElementById(s);if(!i)return;const d=()=>{i.querySelectorAll("button[data-unit]").forEach(m=>{m.classList.toggle("active",m.dataset.unit===u)})};d(),i.addEventListener("click",m=>{const r=m.target.closest("button[data-unit]");if(!r)return;const g=r.dataset.unit;g&&g!==u&&(u=g,localStorage.setItem(M,u),d(),refetchWeather())})}document.addEventListener("DOMContentLoaded",()=>{R(o);const s="a9c23e068a0e62f0ae23ab4a0336b395",i=document.getElementById("addbutton"),d=document.getElementById("search-input"),m=document.getElementById("search-btn"),r=document.getElementById("city"),g=document.getElementById("temp"),$=document.getElementById("description"),D=document.getElementById("humidity"),O=document.getElementById("wind"),A=document.getElementById("weather-icon"),z=document.getElementById("accButton"),w=document.getElementById("accSett"),G=document.getElementById("closeSett"),k=document.getElementById("bg-video"),x=document.getElementById("preloader"),K=document.getElementById("lang-toggle");tt("unitToggle"),K?.addEventListener("click",()=>{V(o==="ru"?"en":"ru"),_()}),k?.addEventListener("canplaythrough",()=>{x&&(x.style.opacity="0",setTimeout(()=>x.style.display="none",500))}),z?.addEventListener("click",()=>{w&&(w.style.display=w.style.display==="flex"?"none":"flex")}),G?.addEventListener("click",()=>{w&&(w.style.display=w.style.display==="flex"?"none":"flex")}),function(){const n=document.getElementById("auth-area");n&&fetch("/api/whoami/",{method:"GET",credentials:"same-origin",headers:{Accept:"application/json"}}).then(e=>e.json()).then(e=>{e.authenticated&&(n.innerHTML=`
          <div class="user-badge">
            <span class="user-name">üëã ${e.username}</span>
            <a href="/favorites/" class="btn-ghost" data-i18n="nav.favorites">${c["nav.favorites"][o]}</a>
            <a href="/logout/" class="btn-danger" data-i18n="nav.logout">${c["nav.logout"][o]}</a>
          </div>
        `)}).catch(()=>{})}(),i?.addEventListener("click",async()=>{const t=i.dataset.city||r?.textContent?.trim();if(!t){alert(c["msg.no_city"][o]);return}try{const n=await fetch("/api/favorites/add/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":Y("csrftoken")},credentials:"same-origin",body:JSON.stringify({name:t})});if(n.redirected){window.location.href=n.url;return}const e=await n.json().catch(()=>({}));if(!n.ok)throw new Error(e.error||`HTTP ${n.status}`);alert(c["msg.add_ok"][o])}catch{alert(c["msg.add_err"][o])}});function Y(t){const n=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return n?n.pop():""}function J(t){const n=Math.floor(t/22.5+.5)%16,e=["–°","–°–í","–í","–Æ–í","–Æ","–Æ–ó","–ó","–°–ó"];return o==="ru"?e[n%e.length]:["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][n]}function Q(t,n){const e=n&&n.includes("n");let a="/static/videos/default.mp4";t==="Clear"?a=e?"/static/videos/clear-night.mp4":"/static/videos/sunny.mp4":t==="Rain"?a=e?"/static/videos/rain-night.mp4":"/static/videos/rain.mp4":t==="Snow"?a=e?"/static/videos/snow-night.mp4":"/static/videos/snow.mp4":t==="Clouds"?a=e?"/static/videos/clouds-night.mp4":"/static/videos/clouds.mp4":t==="Thunderstorm"?a="/static/videos/thunder.mp4":t==="Drizzle"?a="/static/videos/drizzle.mp4":(t==="Mist"||t==="Fog")&&(a="/static/videos/fog.mp4"),k&&(k.src=a)}function H(t){r.textContent=t.name,g.textContent=`${Math.round(t.main.temp)}${S()}`,$.textContent=t.weather[0].description,D.textContent=`${c["weather.humidity"][o]}: ${t.main.humidity}%`,O.textContent=`${c["weather.wind"][o]}: ${t.wind.speed} ${Z()}, ${J(t.wind.deg)}`,A.src=`https://openweathermap.org/img/wn/${t.weather[0].icon}@4x.png`,A.alt=t.weather[0].description,Q(t.weather[0].main,t.weather[0].icon)}function B(t){const n=document.getElementById("hours");n&&(n.innerHTML="",t.forEach(e=>{const l=new Date(e.dt_txt).getHours().toString().padStart(2,"0"),p=document.createElement("div");p.className="hour-card",p.innerHTML=`
        <p>${l}:00</p>
        <img src="https://openweathermap.org/img/wn/${e.weather[0].icon}@2x.png" alt="${e.weather[0].description}">
        <p>${Math.round(e.main.temp)}${S()}</p>
      `,n.appendChild(p)}))}async function U(t){C=t;try{const n=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(t)}&appid=${s}&units=${u}&lang=${o}`),e=await n.json();return n.ok&&Number(e.cod)===200?(H(e),v={lat:e.coord.lat,lon:e.coord.lon},i&&(i.dataset.city=e.name),await j(e.coord.lat,e.coord.lon),!0):(r.textContent=c["msg.city_not_found"][o],i&&delete i.dataset.city,!1)}catch{return r.textContent=c["msg.load_error"][o],i&&delete i.dataset.city,!1}}async function F(t,n){try{const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${t}&lon=${n}&appid=${s}&units=${u}&lang=${o}`),a=await e.json();e.ok&&Number(a.cod)===200?(H(a),C=a.name,v={lat:t,lon:n},i&&(i.dataset.city=a.name),await j(t,n)):r.textContent=c["msg.geo_fail"][o]}catch{r.textContent=c["msg.load_error"][o]}}async function j(t,n){try{const a=await(await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${t}&lon=${n}&appid=${s}&units=${u}&lang=${o}`)).json(),l={};a.list.forEach(y=>{const f=new Date(y.dt_txt).toISOString().split("T")[0];l[f]||(l[f]=[]),l[f].push(y)});const p=document.getElementById("week-forecast");if(!p)return;p.innerHTML="",Object.keys(l).forEach((y,I)=>{if(I===0)return;const f=l[y];let N=1/0,b=-1/0,W=f.find(h=>h.dt_txt.includes("12:00:00"))||f[Math.floor(f.length/2)];f.forEach(h=>{h.main.temp_min<N&&(N=h.main.temp_min),h.main.temp_max>b&&(b=h.main.temp_max)});const E=document.createElement("div");E.className="day-card",E.innerHTML=`
          <p class="day-name">${new Date(y).toLocaleDateString(X(),{weekday:"long"})}</p>
          <img src="https://openweathermap.org/img/wn/${W.weather[0].icon}@2x.png" id="weather-icon" alt="${W.weather[0].description}">
          <p>${W.weather[0].description}</p>
          <p>–ú–∏–Ω: ${Math.round(N)}${S()} | –ú–∞–∫—Å: ${Math.round(b)}${S()}</p>
        `,p.appendChild(E),E.addEventListener("click",()=>{document.querySelectorAll(".day-card").forEach(h=>h.classList.remove("active")),E.classList.add("active"),B(l[y])})});const T=Object.keys(l)[0];T&&(B(l[T]),document.getElementById("first-card")?.addEventListener("click",()=>{document.querySelectorAll(".day-card").forEach(I=>I.classList.remove("active")),B(l[T])}))}catch{const e=document.getElementById("week-forecast");e&&(e.innerHTML=`<p>${c["msg.forecast_fail"][o]}</p>`)}}function q(){const t=(d?.value||"").trim();t&&(window.location.href=`/search/?q=${encodeURIComponent(t)}`)}m?.addEventListener("click",q),d?.addEventListener("keydown",t=>{t.key==="Enter"&&q()});async function L(){if(!navigator.geolocation){r.textContent=c["msg.geo_unavailable"][o];return}navigator.geolocation.getCurrentPosition(async t=>{const{latitude:n,longitude:e}=t.coords;await F(n,e)},()=>{r.textContent=c["msg.geo_denied"][o]})}(async function(){const e=new URLSearchParams(window.location.search).get("q");e?await U(e)||(await L(),window.history&&window.history.replaceState&&window.history.replaceState({},"","/search/")):await L()})();function _(){C?U(C):v?F(v.lat,v.lon):L()}window.refetchForUnits=_,window.refetchWeather=_});
